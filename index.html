 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>WorkerHire – Premium</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#eef3ff] text-gray-800">

<div class="max-w-4xl mx-auto mt-10 p-6 bg-white rounded-2xl shadow-xl">

  <h1 class="text-3xl font-bold text-blue-700 mb-4">WorkerHire Premium</h1>

  <!-- Switch -->
  <div class="flex space-x-3">
    <button onclick="setView('customer')" id="btnCustomer" class="px-4 py-2 bg-blue-700 text-white rounded-xl">
      Customer
    </button>
    <button onclick="setView('worker')" id="btnWorker" class="px-4 py-2 bg-gray-200 rounded-xl">
      Worker
    </button>
  </div>

  <div id="content" class="mt-8"></div>

</div>

<script>
const BACKEND_URL = "https://workerhire-production-7363.up.railway.app";  
// ↑ yahi tumhara backend URL hai

const RAZORPAY_KEY = "rzp_live_RjGSirxUwgP8pU";  
// ↑ apna real Razorpay key ID (public key) yahan dalna
let view = "customer";
let selectedWorker = null;
let workers = [];
let customer = null;

// Load Workers
async function loadWorkers() {
  const res = await fetch(BACKEND_URL + "/workers");
  workers = await res.json();
}

// Render UI
function setView(v) {
  view = v;
  document.getElementById("btnCustomer").className =
    v === "customer" ? "px-4 py-2 bg-blue-700 text-white rounded-xl" : "px-4 py-2 bg-gray-200 rounded-xl";

  document.getElementById("btnWorker").className =
    v === "worker" ? "px-4 py-2 bg-blue-700 text-white rounded-xl" : "px-4 py-2 bg-gray-200 rounded-xl";

  render();
}

function render() {
  if (view === "customer") renderCustomer();
  else renderWorker();
}

// CUSTOMER UI
function renderCustomer() {
  let html = `
  <h2 class="text-xl font-semibold text-blue-600">Quick Booking</h2>
  <label class="block mt-4">Select Worker</label>
  <select id="wk" class="w-full border p-2 rounded">
    ${workers.map(w => `<option value="${w.id}">${w.name} (${w.rate}/hr)</option>`).join("")}
  </select>

  <label class="block mt-4">Hours</label>
  <input id="hrs" type="number" class="w-full border p-2 rounded" />

  <button onclick="book()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-xl">Book & Pay</button>
  `;
  document.getElementById("content").innerHTML = html;
}

// BOOKING FUNCTION
async function book() {
  const workerId = document.getElementById("wk").value;
  const hours = Number(document.getElementById("hrs").value);
  const worker = workers.find(x => x.id === workerId);
  const amount = worker.rate * hours;

  const order = await fetch(BACKEND_URL + "/create-order", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ amount })
  }).then(r => r.json());

  var options = {
    key: RAZORPAY_KEY,
    amount: amount * 100,
    currency: "INR",
    order_id: order.id,
    handler: async function (resp) {
      await fetch(BACKEND_URL + "/confirm-payment", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          workerId,
          customerId: "demo-customer",
          hours,
          amount,
          paymentId: resp.razorpay_payment_id
        })
      });

      alert("Booking Completed!");
    }
  };
  new Razorpay(options).open();
}

// WORKER UI
function renderWorker() {
  let html = `
  <h2 class="text-xl font-semibold text-blue-600">Add Worker</h2>

  <input id="wname" placeholder="Name" class="w-full border p-2 rounded mt-3"/>
  <input id="wcat" placeholder="Category" class="w-full border p-2 rounded mt-3"/>
  <input id="wrate" placeholder="Rate/hr" type="number" class="w-full border p-2 rounded mt-3"/>
  <input id="wdesc" placeholder="Description" class="w-full border p-2 rounded mt-3"/>

  <button onclick="addWorker()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-xl">Add Worker</button>
  `;
  document.getElementById("content").innerHTML = html;
}

// ADD WORKER
async function addWorker() {
  const name = document.getElementById("wname").value;
  const category = document.getElementById("wcat").value;
  const rate = Number(document.getElementById("wrate").value);
  const desc = document.getElementById("wdesc").value;

  await fetch(BACKEND_URL + "/workers", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ name, category, rate, desc })
  });

  alert("Worker Added!");
  loadWorkers();
}

loadWorkers().then(render);
</script>

</body>
</html>
